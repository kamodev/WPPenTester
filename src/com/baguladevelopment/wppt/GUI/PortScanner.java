package com.baguladevelopment.wppt.GUI;

// Include all the pacckages needed for this class
import java.awt.BorderLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.net.*;
import javax.swing.JButton;
import javax.swing.JPanel;
import javax.swing.JTable;
import javax.swing.JInternalFrame;
import javax.swing.JScrollPane;

// Local objects to the package
import com.baguladevelopment.wppt.models.PSDataModel;

public class PortScanner extends JInternalFrame implements ActionListener
{
    // Base UI panels
    JPanel m_rootPanel = new JPanel();
    
    // The buttons for the window
    JButton m_btnStart = new JButton("Start");

    //    Table objects
    String m_columnNames[] = {"Server Name", "IP Adress", "Port Number", "Status"};
    Object m_psData[][] = {};
    
    // Table for the messages to go to
    JTable m_msgTable = new JTable(m_psData, m_columnNames);
    
    // The Scroll Pane
    JScrollPane m_scrollPane = new JScrollPane(m_msgTable);
    
    
    
    // Constructor
    public PortScanner()
    {
        // Setup the main Window
        setTitle("Port Scanner");
        setClosable(true);
        setDefaultCloseOperation(JInternalFrame.DISPOSE_ON_CLOSE);
        setResizable(false);
        setIconifiable(true);
        setSize(600, 600);
        setVisible(true);
               
        // Setup the start button        
        m_btnStart.addActionListener(this);
        m_btnStart.setActionCommand("start");
        m_btnStart.setToolTipText("Start Port Scan");
        
        // Add components to the panel
        m_rootPanel.setLayout(new BorderLayout());
        //m_rootPanel.add(m_btnStart, BorderLayout.NORTH);
        m_rootPanel.add(m_scrollPane,BorderLayout.NORTH);
                
        // Add the panels to the window
        this.setContentPane(m_rootPanel);
    }

    // Scan the server for open ports
    public void scan()
    {
        if (isPortActive("127.0.0.1", 80))
        {
            System.out.println("Server 127.0.0.1 has Port 80 active!");
        }
        else if (isPortActive("10.34.162.38", 80))
        {
            System.out.println("Server 10.34.162.38 has Port 80 active!");
        }
        else
        {
            System.out.println("Server 127.0.0.1 does not have Port 80 active!");
            System.out.println("OR");
            System.out.println("Server 10.34.162.38 does not have Port 80 active!");
        }
    }

    //    Check to see if the port is active
    private boolean isPortActive(String target, int port)
    {
        // All method based base types
        boolean isActive = false;

        // All method based objects
        Socket skt = null;

        try
        {
            skt = new Socket(target, port);
            skt.close();
            isActive = true;
        }
        catch(Exception ex)
        {
            System.out.println("Server does not have Port 80 active!");
        }

        return isActive;
    }

    // All the action for the program run through here
    @Override
    public void actionPerformed(ActionEvent e)
    {
        switch(e.getActionCommand())
        {
            case "start":
                this.scan();
                break;
        }
    }
}
